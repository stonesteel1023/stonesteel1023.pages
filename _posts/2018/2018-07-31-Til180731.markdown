---
layout: "post"
title: "TIL180731"
date: "2018-07-31 20:50"
categories: coding
tag:
- UAC
comments : true
---

# 사용자 계정 컨트롤(UAC)이란?

프로그램에서 관리자 수준의 권한이 필요한 변경 작업을 수행할 때 이를 사용자에게 알려
컴퓨터를 제어할 수 있도록 도와주는 윈도우 기능(윈도우 비스타부터)
사용자 계정 컨트롤은 맬웨어라고 통칭되는 악성 프로그램이 무단으로 진행하는 자동 설치를
중지하여 시스템을 손상시키지 않도록 방지하는 데 도움을 주며 사용자가 실수로 시스템 설정
을 변경하지 않도록 방지하는 것을 도와줌

## 윈도우7 ACL(Access Control List)와 파일 권한 수정

리눅스에서는 파일을 관리하기 위해 각 사용자나 그룹에 RWX 권한지정을 파일에 대한 보안을
관리. 마찬가지로 윈도우에서도 이와 비슷한 형태의 AC(Access Control)를 지원하는데 리눅
스에서와 달리 모든 개체들에 대해 RWX 권한이 지정됨
이러한 권한 관리 방식은 각 사용자나 그룹이 개개의 파일이나 폴더에 접근할 수 있는지를
알려주며 이를 기반으로 접근에 제한을 둠

 * 기본적으로 폴더에 6가지 기본 권한과 파일에 5가지 기본 권한이 제공됨
1. 모든 권한
 사용자나 그룹은 목록에 표시된 모든 작업을 수행할 수 있고, 권한을 변경할 수도 있다.
2. 수정
 사용자나 그룹은 파일이나 폴더의 내용을 볼 수 있고, 열고, 편집할 수 있으며 하위 폴더
 나 파일을 생성, 삭제, 실행이 가능하다.
3. 읽기 및 실행
 사용자나 그룹은 파일이나 폴더의 내용을 볼 수 있고, 파일을 열 수 있으며, 프로그램을
 실행할 수 있다.
4. 폴더 내용 보기
 사용자나 그룹은 폴더의 내용을 볼 수 있다. 폴더에만 부여되는 권한.
5. 읽기
 폴더를 열 수 있지만 내용을 편집할 수는 없다.
6. 쓰기
 사용자나 그룹은 파일이나 하위 폴더를 생성하거나 열 수 있고, 기존 파일의 내용을 편집
 할 수도 있다.


* 이 외에도 파일과 폴더에 세부적인 제어를 설정하는 다른 권한들이 있음. 이러한 권한은 자체
적인 내장 그룹을 통해 쉽게 제어할 수 있도록 제공되고 있으며, 로그온 계정이 포함된 그룹
에 따라 사용 권한을 자동으로 할당하도록 되어 있음. 아래는 윈도우에서 기본적으로 제공하
는 관리(권한) 그룹

- 관리자(Administrators), 사용자(Users), Backup Operators, Cryptographic Operators,
Distributed COM Users, Event Log Readers, Guests, HomeUsers, IIS_IUSRS, Network
Configuration Operators, Performance Log Users, Performance Monitor Users, Power
Users, Remote Desktop Users, Replicator

> 종류가 매우 많지만, 그다지 어려운 개념은 없으며 자주 사용되는 몇몇 권한을 제외하고는 몰라도 크게 상관없음

그래서 사용자가 시스템의 주요 설정을 변경하려는 경우 관리자 권한이 필요하게 되고,
이런 명령들을 일반 사용자 계정에서 실행하면 사용자 계정 컨트롤이 해당 명령의 실행을
차단하고 결국 액세스가 거부되었다는 메세지를 출력하게 됨

* 따라서 이런 명령들을 사용하려면 다음과 같은 방법 중 하나를 따라야 한다.

 1. 사용자 계정 컨트롤(UAC) 끄기 - 보안 상 권장X
 2. 어드민 계정(Administrator) 활성화 - 어드민 계정을 활성화하여 슈퍼 관리자 계정을 사용하는 방법. 이 방법은  윈도우 비스타, 윈도우 7에서 주로 사용된 방법이나, 윈도우 8에서는 어드민 계정을 사용하는 경우 윈도우8의 최대 강점인 앱을 사용할 수 없음
 3. 명령 프롬프트를 관리자 권한으로 실행

> 이하로는 3번의 내용을 중점적으로 다룸

### 3-1

* [ICACLS 파일이름 /grant(:r) SID:perm(...)][599fcda7]

  [599fcda7]: http://blog.naver.com/PostView.nhn?blogId=mjnms&logNo=220464088526&parentCategoryNo=&categoryNo=&viewDate=&isShowPopularPosts=false&from=postView "[출처] 파일 시스템 관리 #10 - 파일 권한 수정. ICACLS 명령|작성자 MJSoft)"

위 내용 중 /grant 옵션이 권한을 설정하도록 하는 옵션이며, 매우 자주 사용되는 옵션이다. 이 외에도 많은 옵션들을 제공하지만 자주 쓰이지 않고, 대부분 AD(Active Directory)에서 정책으로 설정되어 중복되므로 생략하였다. 위 /grant 옵션을 다시 보자. SID 이후에 오는 perm이 바로 권한을 어떻게 할지 결정하는 시퀸스이다. perm으로 올 수 있는 값들은 아래와 같다.

 권한| 옵션  |  설명
--|--|--
일반  | N   |  권한 없음
일반  | F   |  모든 권한
일반  | M   |  수정 권한
일반  | RX  |  읽기 및 실행 권한
일반  | R   |  읽기 전용 권한
일반  | W   |  쓰기 전용 권한
일반  | D   |  삭제 권한
--|--|--
특수  | DE  |  삭제
특수  | RC  |  읽기 제어
특수  | WDAC|  DAC 쓰기
특수  | WO  |  쓰기 소유자
특수  | S   |  동기화
특수  | AS  |  엑세스 시스템 보안
특수  | MA  |  최대한 허용
특수  | GR  |  일반 읽기
특수  | GW  |  일반 쓰기
특수  | GE  |  일반 실행
특수  | GA  |  일반 전체
특수  | RD  |  데이터 읽기/디렉토리 나열
특수  | WD  |  데이터 쓰기/파일 추가
특수  | AD  |  데이터 추가/하위 디렉토리 추가
특수  | REA |  확장 특성 읽기
특수  | WEA |  확장 특성 쓰기
특수  | X   |  실행/트래버스
특수  | DC  |  자식 삭제
특수  | RA  |  특성 읽기
특수  | WA  |  특성 쓰기
※ 특수권한은 (...)에 설정 필요

### 3-2

+ 배치파일 실행시 항상 관리자 권한을 주고자 한다면

`HKEY_LOCAL_MACHINE\SOFTWARE\Classes\cmdfile\shell 의 기본값을 runas로 바꾸기`


+ 레지스트리 편집이 귀찮다면

`reg add HKLM\Software\Classes\cmdfile\shell /ve /t REG_SZ /d "runas" /f`


+ 원상 복구는

`reg delete HKLM\Software\Classes\cmdfile\shell /ve /f`
