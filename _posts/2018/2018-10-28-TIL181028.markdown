---
layout : post
date : 2018-10-28 18:30
title : "To 30 Billion and Beyond"
comments: true
---

# To 30 Billion and Beyond

> ì¶œì²˜: https://www.haruair.com/blog/4108

* Several years ago I created a free web service, ipify. ipify is a freely available, highly scalable ip address lookup service. When you query its REST API, it returns your public-facing IP address.

I created ipify because at the time I was building complex infrastructure management software and needed to dynamically discover the public IP address of some cloud instances without using any management APIs.

When I searched online for freely available reverse IP lookup services I didnâ€™t find any suitable solutions:

There were websites I could attempt to scrape my IP from (but this is bad form, and would likely result in complaints from the host)
There were APIs for this that charged money (yuck!)
There were APIs that allowed you to do a limited number of lookups per day (which scared me as I was managing a lot of instances at the time)
There were APIs that appeared to be what I wanted, but upon using them theyâ€™d error out, go down randomly, or just otherwise not be of high quality. When I inspected the dig records of a particular provider, I noticed that the entire service was running on a single server (with an A record) that was terminating requests directly: not the most scalable/highly available service in the world.
There was an API service that looked somewhat OK but was trying to raise money via donations to stay alive. Integrating with an API service on the brink of death didnâ€™t make me feel terribly comfortable.
Because of all these reasons I figured Iâ€™d just throw a small service together myself and solve the problem for as many people as possible. After all: writing software to return a single string isnâ€™t terribly hard: why shouldnâ€™t I do it?

I assumed that worst case Iâ€™d spend $30 bucks or so per month and treat it as a public service.

* ëª‡ ë…„ ì „ì— ë¬´ë£Œ ì›¹ì„œë¹„ìŠ¤ì¸ ipifyë¥¼ ë§Œë“¤ì—ˆìŠµë‹ˆë‹¤. ipifyëŠ” ë¬´ë£Œë¡œ ì‚¬ìš©í•  ìˆ˜ ìˆëŠ”, ê³ ë„ë¡œ í™•ì¥ ê°€ëŠ¥í•œ IP ì£¼ì†Œ ê²€ìƒ‰ ì„œë¹„ìŠ¤ì…ë‹ˆë‹¤. REST APIë¥¼ í˜¸ì¶œí•˜ë©´ ì–´ëŠ í¼ë¸”ë¦­ IP ì£¼ì†Œë¥¼ ì‚¬ìš©í•˜ê³  ìˆëŠ”ì§€ í™•ì¸ í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.

ipifyë¥¼ ë§Œë“  ë‹¹ì‹œì—ëŠ” ë³µì¡í•œ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê´€ë¦¬ ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ë§Œë“¤ê³  ìˆì—ˆê³  í´ë¼ìš°ë“œ ì¸ìŠ¤í„´ìŠ¤ì—ì„œ ê´€ë¦¬ìš© APIë¥¼ ì‚¬ìš©í•˜ì§€ ì•Šê³  ë™ì ìœ¼ë¡œ í¼ë¸”ë¦­ IP ì£¼ì†Œë¥¼ ì•Œì•„ë‚´ì•¼ í–ˆì—ˆìŠµë‹ˆë‹¤.

ë¬´ë£Œë¡œ ì‚¬ìš© ê°€ëŠ¥í•œ ì—­ IP ê²€ìƒ‰ ì„œë¹„ìŠ¤ë¥¼ ê²€ìƒ‰í•´ë´¤ì§€ë§Œ ì í•©í•œ í•´ê²°ì±…ì„ ì°¾ì§€ ëª»í–ˆìŠµë‹ˆë‹¤.

IPë¥¼ ìŠ¤í¬ë© í•  ìˆ˜ ìˆëŠ” ì›¹ì‚¬ì´íŠ¸ê°€ ìˆê¸´ í–ˆìŠµë‹ˆë‹¤. (í•˜ì§€ë§Œ ë³„ë¡œ ì¢‹ì€ í˜•íƒœê°€ ì•„ë‹ˆê³  í˜¸ìŠ¤íŠ¸ì—ì„œ ì‚¬ìš©í•˜ê¸°ì—” ë¶ˆí¸í•©ë‹ˆë‹¤)
ë¹„ìš©ì„ ì²­êµ¬í•˜ëŠ” APIë„ ìˆì—ˆìŠµë‹ˆë‹¤. (ìŒ!)
ì¼ê°„ ì¡°íšŒ íšŸìˆ˜ë¥¼ ì œí•œí•˜ëŠ” APIë„ ìˆì—ˆìŠµë‹ˆë‹¤. (í•œêº¼ë²ˆì— ë§ì€ ì¸ìŠ¤í„´ìŠ¤ë¥¼ ê´€ë¦¬í•´ì•¼ í–ˆê¸°ì— ì‚¬ìš©í•˜ê¸° ë‘ë ¤ì› ìŠµë‹ˆë‹¤)
ì œê°€ ì›í•˜ëŠ” ë°©ì‹ì˜ APIë„ ìˆì—ˆì§€ë§Œ, ì˜¤ë¥˜ê°€ ë°œìƒí•˜ê¸°ë„ í•˜ê³  ê°€ë” ì„œë¹„ìŠ¤ê°€ ë‚´ë ¤ê°€ê¸°ë„ í•˜ê±°ë‚˜ ì§ˆì ìœ¼ë¡œ ë–¨ì–´ì§€ê¸°ë„ í–ˆìŠµë‹ˆë‹¤. ì–´ëŠ ì œê³µìë¥¼ digë¡œ ì‚´í´ë´¤ë”ë‹ˆ ì „ì²´ ì„œë¹„ìŠ¤ê°€ ë‹¨ì¼ ì„œë²„ (A ë ˆì½”ë“œ)ì—ì„œ ë™ì‘í•˜ê³  ê·¸ ì„œë²„ì—ì„œ ìš”ì²­ì´ ì§ì ‘ ì¢…ë£Œë˜ì—ˆìŠµë‹ˆë‹¤. ì„¸ê³„ ê·œëª¨ë¡œ í™•ì¥ ê°€ëŠ¥í•˜ê±°ë‚˜ ê³ ê°€ìš©ì„±ì˜ ì„œë¹„ìŠ¤ë¼ê³  ë§í•˜ê¸° ì–´ë ¤ì› ìŠµë‹ˆë‹¤.
ë³´ê¸°ì—” ê´œì°®ì€ APIë„ ìˆì—ˆì§€ë§Œ, ì§€ì†í•´ì„œ ìœ ì§€í•˜ê¸° ìœ„í•œ ê¸°ë¶€ë¥¼ ë°›ìœ¼ë ¤ê³  í–ˆìŠµë‹ˆë‹¤. ì‚¬ìš©í•˜ë ¤ëŠ” API ì„œë¹„ìŠ¤ê°€ ì–¸ì œ ì£½ì„ì§€ ëª¨ë¥¼ ìƒí™©ì´ë¼ë‹ˆ ë§ˆìŒ ë†“ê³  ì‚¬ìš©í•  ìˆ˜ ì—†ì—ˆìŠµë‹ˆë‹¤.
ì´ëŸ° ì´ìœ ë¡œ ì¸í•´ ì‘ì€ ì„œë¹„ìŠ¤ë¥¼ ì§ì ‘ ë§Œë“¤ì–´ì„œ ë‚´ ë¬¸ì œì™€ ê°€ëŠ¥í•œ í•œ ë§ì€ ì‚¬ëŒì˜ ë¬¸ì œë¥¼ í•´ê²°í•˜ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤. ë”êµ°ë‹¤ë‚˜ í•˜ë‚˜ì˜ ë¬¸ìì—´ì„ ë°˜í™˜í•˜ëŠ” ì†Œí”„íŠ¸ì›¨ì–´ë¥¼ ì‘ì„±í•˜ëŠ” ì¼ì€ ê·¸ë ‡ê²Œ ì—„ì²­ ì–´ë ¤ìš´ ì¼ì€ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤. í•˜ì§€ ë§ì•„ì•¼ í•  ì´ìœ ê°€ ìˆì„ê¹Œìš”?

ê°€ì¥ ìµœì•…ì˜ ê²½ìš°ë¼ê³  ìƒìƒí•´ë³¼ ìˆ˜ ìˆëŠ” ì¼ì€ ê¸°êº¼í•´ì•¼ ì›” 30ë‹¬ëŸ¬ê°€ëŸ‰ ì‚¬ìš©í•˜ê³  ê³µê°œ ì„œë¹„ìŠ¤ë¼ëŠ” ì ì„ ì—¼ë‘ì— ë‘ê³  ë‹¤ë£¨ëŠ” ì •ë„ì˜€ìŠµë‹ˆë‹¤.

## ipify v0

* The first iteration of ipify was quite simple. I wrote an extremely tiny (< 50 LOC) API service in Node (I was playing around with Node a lot at the time). Since the entire premise of the ipify service is returning a string, I figured this was a perfect use case for Node as a technology: handling a lot of requests with minimal CPU usage.

After I had the API service built in Node, I threw together a simple static site to power the front-end and deployed it into an S3 bucket on Amazon. I then configured a CloudFront origin (Amazonâ€™s CDN service) to sit in front of the S3 bucket and cache the pages for ultra-fast load times.

Now, Iâ€™m not a designer by any stretch of the imaginationâ€¦ But, with a little bootstrap love things turned out half-decent =)

After getting everything working I did some quick testing and things seemed to be working ok so I moved onto the next phase: deployment.

* ipifyì˜ ì²« ì½”ë“œëŠ” ìƒë‹¹íˆ ë‹¨ìˆœí–ˆìŠµë‹ˆë‹¤. 50ì¤„ë„ ë˜ì§€ ì•ŠëŠ” ì‘ì€ ì½”ë“œë¥¼ Nodeë¡œ ì‘ì„±í–ˆìŠµë‹ˆë‹¤. (ë‹¹ì‹œì— ë§ì€ ì‹œê°„ì„ Nodeë¥¼ ê°–ê³  ë†€ë©° ì§€ëƒˆìŠµë‹ˆë‹¤.) ipify ì„œë¹„ìŠ¤ê°€ ë¬¸ìì—´ì„ ë°˜í™˜í•˜ëŠ” ì¼ì´ ì „ë¶€ë¼ëŠ” ì „ì œì—ì„œëŠ” Nodeë¥¼ ì‚¬ìš©í•  ê°€ì¥ ì í•©í•œ ê²½ìš°ì¸ ê²ƒì„ ì•Œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì ì€ CPU ì‚¬ìš©ëŸ‰ìœ¼ë¡œ ìˆ˜ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ” ì‘ì—…ì´ì£ .

API ì„œë¹„ìŠ¤ë¥¼ Nodeë¡œ ë§Œë“¤ê³  ë‚˜ì„œ ê°„ë‹¨í•œ ì •ì  ì‚¬ì´íŠ¸ë¥¼ í”„ë¡ íŠ¸ì—”ë“œë¡œ ë¶™ì—¬ ì•„ë§ˆì¡´ì˜ S3ì— ì˜¬ë ¸ìŠµë‹ˆë‹¤. ê·¸ë¦¬ê³  S3 ë²„í‚· ì•ì— ì•„ë§ˆì¡´ì˜ CDN ì„œë¹„ìŠ¤ì¸ CloudFrontë¥¼ ì„¤ì •í•´ì„œ í˜ì´ì§€ë¥¼ ìºì‹±í•˜ëŠ” ê²ƒìœ¼ë¡œ ì—„ì²­ ë¹ ë¥´ê²Œ ë¶ˆëŸ¬ì˜¬ ìˆ˜ ìˆë„ë¡ í–ˆìŠµë‹ˆë‹¤.

ì–´ë–¤ ìƒìƒì˜ ë‚ ê°œë¥¼ í¼ì³ë´ë„ ì €ëŠ” ë””ìì´ë„ˆê°€ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ë‹¤í–‰íˆ bootstrapì„ ì‚¬ìš©í•´ì„œ ì¡°ê¸ˆ ë‚˜ì€ ëª¨ìŠµì„ ê°–ì¶œ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. =)

ëª¨ë“  ì¤€ë¹„ê°€ ëë‚œ í›„ì— ê°„ë‹¨í•˜ê²Œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. ëª¨ë“  ê²ƒì´ ì¤€ë¹„ë˜ì—ˆë‹¤ëŠ” ìƒê°ì— ë‹¤ìŒ ë‹¨ê³„ì¸ ë°°í¬ë¡œ ë„˜ì–´ê°”ìŠµë‹ˆë‹¤.

## Enter Heroku

* Iâ€™m a big fan of Heroku (Iâ€™ve even written a book about it). Iâ€™ve been using it for many years now and consider it to be one of the most underrated services in the developer world. If youâ€™ve never used it, go check it out!

I decided that if I wanted to run ipify in a scalable, highly available and cheap way then Heroku was the simplest and best option: so thatâ€™s what I went with.

I deployed ipify to Heroku in a minute or two, ran it on a single dyno (web server), and did some limited testing. Things again seemed to be working well and I was feeling pretty happy with myself.

If you arenâ€™t familiar with Heroku, let me explain how ipifyâ€™s infrastructure was working:

Heroku ran my ipify web service on a small dyno (web server) with 512M RAM and limited CPU
If my process crashed or had any critical issues, Heroku would automatically restart it for me
Heroku ran a load balancer that accepted all incoming requests for my app and forwarded them to my dyno (web server) to process the request
This is a nice setup because:

Everything is highly available: Herokuâ€™s load balancers, my dyno, everything
It requires no maintenance, configuration management, or any sort of deployment code. Itâ€™s 100% automated.
Itâ€™s cheap: I paid ~$7/mo to run this single web server
Itâ€™s fast: Heroku runs on top of Amazon Web Services (AWS), so my infrastructure was running in one of the most popular cloud hosted destinations in the world: AWS us-east (Virginia). This means it is geographically running on the east coast of the US: just across the water from Europe, and not terribly far from the rest of the continental US. This means users from most parts of the world wouldnâ€™t have to make an enormous hop to reach the service.
At this point, I was feeling pretty good. This took < 1 dayâ€™s worth of work to build, setup, test, and move into production.

I then integrated ipify into my own infrastructure management code to solve the problem I had initially needed to resolve.

Things were going great for about a month before I started noticing some issuesâ€¦

* ì €ëŠ” Herokuì˜ ì™• íŒ¬ì…ë‹ˆë‹¤. (ì‹¬ì§€ì–´ Herokuì— ëŒ€í•œ ì±…ë„ ì¼ìŠµë‹ˆë‹¤.) Herokuë¥¼ ìˆ˜ë…„ ê°„ ì‚¬ìš©í•˜ê³  ìˆê³  ê°œë°œ ì„¸ê³„ì— ìˆì–´ì„œ ê°€ì¥ ì €í‰ê°€ë˜ê³  ìˆëŠ” ì„œë¹„ìŠ¤ ì¤‘ í•˜ë‚˜ë¼ê³  ìƒê°í•©ë‹ˆë‹¤. í•œ ë²ˆë„ ì‚¬ìš©í•´ë³¸ ì ì´ ì—†ë‹¤ë©´ ì§€ê¸ˆ í™•ì¸í•´ë³´ì‹œê¸¸ ë°”ëë‹ˆë‹¤!

ipifyë¥¼ í™•ì¥ ê°€ëŠ¥í•˜ê³  ê³ ê°€ìš©ì„±ìœ¼ë¡œ, ê·¸ë¦¬ê³  ì €ë ´í•˜ê²Œ ìš´ì˜í•˜ë ¤ë©´ Heroku ë§Œí¼ ë‹¨ìˆœí•˜ê³  ì¢‹ì€ ì„ íƒì§€ê°€ ì—†ë‹¤ê³  ìƒê°í•˜ê³ ëŠ” Herokuë¥¼ ì‚¬ìš©í•˜ê¸°ë¡œ ê²°ì •í–ˆìŠµë‹ˆë‹¤.

ipifyë¥¼ Herokuì— 1~2ë¶„ ì •ë„ ê±¸ë ¤ ë°°í¬í•˜ê³  ë‹¨ì¼ dyno(ì›¹ì„œë²„)ë¡œ ì‹¤í–‰í•œ í›„ì— ì œí•œì ìœ¼ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤. ì—¬ì „íˆ ì˜ ë™ì‘í•˜ë‹ˆ ìŠ¤ìŠ¤ë¡œ ë¿Œë“¯í•œ ê¸°ë¶„ì´ ë“¤ì—ˆìŠµë‹ˆë‹¤.

Herokuì— ìµìˆ™í•˜ì§€ ì•Šë‹¤ë©´ ipify ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ê°€ ì–´ë–»ê²Œ ë™ì‘í•˜ëŠ”ì§€ ì‚´í´ë´…ì‹œë‹¤.

HerokuëŠ” ipify ì›¹ì„œë¹„ìŠ¤ë¥¼ 512M ë¨ê³¼ ì œí•œëœ CPUì¸ ì‘ì€ dyno (ì›¹ì„œë²„)ì—ì„œ êµ¬ë™í•©ë‹ˆë‹¤.
ë§Œì•½ í”„ë¡œì„¸ìŠ¤ê°€ ì¶©ëŒí•˜ê±°ë‚˜ ì–´ë–¤ ì‹¬ê°í•œ ë¬¸ì œê°€ ë°œìƒí•œë‹¤ë©´ HerokuëŠ” ìë™ìœ¼ë¡œ ì„œë¹„ìŠ¤ë¥¼ ì¬ì‹œì‘í•©ë‹ˆë‹¤.
HerokuëŠ” ì•±ìœ¼ë¡œ ë“¤ì–´ì˜¤ëŠ” ëª¨ë“  ìš”ì²­ì„ ë¡œë“œ ë²¨ëŸ°ìŠ¤ë¥¼ ê±°ì¹œ í›„ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê¸° ìœ„í•´ dyno (ì›¹ì„œë²„)ë¡œ ì „ë‹¬í•©ë‹ˆë‹¤.
ì´ëŸ° ì„¤ì •ì´ ì¢‹ì€ ì´ìœ ëŠ”:

ê³ ê°€ìš©ì„±: Herokuì˜ ë¡œë“œë²¨ëŸ°ì„œ, ì œ dyno, ëª¨ë“  ê²ƒì´ ê³ ê°€ìš©ì„±ì…ë‹ˆë‹¤.
ìœ ì§€ë³´ìˆ˜ë„, ê´€ë¦¬ ì„¤ì •ë„, ì–´ë–¤ ë°°í¬ ì½”ë“œë„ í•„ìš”í•˜ì§ˆ ì•ŠìŠµë‹ˆë‹¤. 100% ìë™ì…ë‹ˆë‹¤.
ì €ë ´í•©ë‹ˆë‹¤. ë‹¨ì¼ ì„œë²„ë¥¼ ìœ„í•´ ì›” ~7ë‹¬ëŸ¬ê°€ëŸ‰ ëƒ…ë‹ˆë‹¤.
ë¹ ë¦…ë‹ˆë‹¤. í—¤ë¡œì¿ ëŠ” ì•„ë§ˆì¡´ ì›¹ì„œë¹„ìŠ¤(AWS) ìƒì—ì„œ ëŒì•„ê°€ë©° ëª¨ë“  ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ëŠ” ì„¸ê³„ì—ì„œ ê°€ì¥ ì¸ê¸°ìˆëŠ” í´ë¼ìš°ë“œ í˜¸ìŠ¤íŠ¸ ìœ„ì¹˜ì¸ AWS ë¯¸ë™ë¶€ (ë²„ì§€ë‹ˆì•„)ì—ì„œ ìš´ì˜ë©ë‹ˆë‹¤. ì´ ì˜ë¯¸ëŠ” ì§€ë¦¬ì ìœ¼ë¡œ US ë™ë¶€ í•´ì•ˆì—ì„œ ìš´ì˜ëœë‹¤ëŠ” ì ì¸ë° ë¬¼ ê±´ë„ˆ ìœ ëŸ½ì´ë‚˜ ë‚˜ë¨¸ì§€ US ì§€ì—­ì—ì„œ ê·¸ë‹¤ì§€ ë©€ì§€ ì•Šë‹¤ëŠ” ì˜ë¯¸ì…ë‹ˆë‹¤. ì„¸ê³„ ëŒ€ë¶€ë¶„ ì§€ì—­ì˜ ì‚¬ìš©ìê°€ ì„œë¹„ìŠ¤ë¥¼ ì‚¬ìš©í•œë‹¤ê³  í•´ë„ ê·¸ë ‡ê²Œ ì˜¤ë˜ ê±¸ë¦¬ì§€ëŠ” ì•Šì„ ê²ë‹ˆë‹¤.
ì§€ê¸ˆê¹Œì§€ëŠ” ìƒë‹¹íˆ ê´œì°®ì•˜ìŠµë‹ˆë‹¤. ë§Œë“¤ê³ , ì„¤ì •í•˜ê³ , í…ŒìŠ¤íŠ¸í•˜ê³ , í”„ë¡œë•ì…˜ìœ¼ë¡œ ì˜®ê¸°ê¸°ê¹Œì§€ 1ì¼ ì´í•˜ì˜ ë…¸ë ¥ìœ¼ë¡œ ëë‚¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

ê·¸ë¦¬ê³ ë‚˜ì„œ ipifyë¥¼ ì œ ì¸í”„ë¼ìŠ¤íŠ¸ëŸ­ì²˜ ê´€ë¦¬ ì½”ë“œì™€ í†µí•©í•˜ëŠ” ê²ƒìœ¼ë¡œ ì›ë˜ í•´ê²°í•˜ë ¤ë˜ ë¬¸ì œë¥¼ ì²˜ë¦¬í–ˆìŠµë‹ˆë‹¤.

í•œ ë‹¬ ì •ë„ ëª¨ë“  ê²ƒì´ ì˜ í˜ëŸ¬ê°”ìŠµë‹ˆë‹¤. ëª‡ ê°€ì§€ ë¬¸ì œë¥¼ ì•Œì•„ì°¨ë¦¬ê¸° ì „ê¹Œì§€ëŠ” ë§ì´ì£ .

## Popularityâ€¦ Ugh

* I never marketed ipify, but it ended up ranking really high for the â€œip address apiâ€ search phrase on Google. I guess all those years working on copy editing and SEO paid off.

Within a month or so, ipify was ranking near the top of Google search results, bringing in thousands of new users. With the increased visibility of the service, I started seeing some issues.

My Heroku load balancer was firing off warnings because my Node server wasnâ€™t servicing incoming requests quickly enough. What ended up happening was:

Too many users would make API requests to ipify
My Node server would start responding to requests slowly so latency would rise
The Heroku load balancer would notice this and start buffering requests before sending them onto my Node server
Because my Node server wasnâ€™t servicing requests quickly enough, my load balancer would return a 503 to the user and the request would die off
Not a pretty picture.

So what I did was simple: I added another Heroku dyno. This way, Iâ€™d have twice the capacity and things would run smoothly again. The downside is that running two â€œproductionâ€ dynos on Heroku spiked my cost up to $50. Once youâ€™ve gone past one dyno, you have to pay normal rates: $25/mo/dyno.

I figured that by now the service had likely capped out in popularity and I was OK paying $50/mo, so Iâ€™d just do that and things would go back to normal.

Butâ€¦ Things didnâ€™t quite work out that way.

Before even a week had passed, I was already getting alerts from Heroku telling me that I was having the same issue as before. When I looked at my stats, I could see that my traffic had doubled, and again it appeared like ipify was just simply getting too much usage.

I added another dyno (brining my monthly cost up to ~$75/mo), but decided to investigate further. Iâ€™m a frugal guy â€“ the idea of losing > $50/mo seemed unpleasant.

* ipifyë¥¼ í™ë³´í•œ ì ì´ ì—†ì§€ë§Œ â€œip address apiâ€ë¥¼ êµ¬ê¸€ì—ì„œ ê²€ìƒ‰í•˜ë©´ ê½¤ ìƒë‹¨ì— ê±¸ë¦¬ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. SEOì™€ ë¬¸êµ¬ ìˆ˜ì •ì— ì‚¬ìš©í•œ ìˆ˜ë…„ ê°„ì˜ ë…¸ë ¥ì´ ë¹›ì„ ë°œí•œ ê²ƒ ê°™ìŠµë‹ˆë‹¤.

ê·¸ë™ì•ˆ ipifyê°€ êµ¬ê¸€ ê²€ìƒ‰ ê²°ê³¼ì—ì„œ ìƒë‹¹íˆ ë†’ì€ ìˆœìœ„ë¡œ ë…¸ì¶œëœ ë•ë¶„ì— ìˆ˜ì²œ ëª…ì˜ ì‚¬ìš©ìê°€ ìƒê²¼ìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ê°€ ë§ì´ ë…¸ì¶œë˜ë©´ì„œ ëª‡ ì´ìŠˆê°€ ë‚˜íƒ€ë‚˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.

ì œ Heroku ë¡œë“œ ë²¨ëŸ°ì„œê°€ ê²½ê³ ë¥¼ ë³´ë‚´ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. Node ì„œë²„ê°€ ë“¤ì–´ì˜¤ëŠ” ìš”ì²­ì„ ì¶©ë¶„íˆ ë¹ ë¥´ê²Œ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ê³  ìˆë‹¤ëŠ” ë‚´ìš©ì´ì—ˆìŠµë‹ˆë‹¤. ê²°ê³¼ì ìœ¼ë¡œ ë‹¤ìŒê³¼ ê°™ì€ ì¼ì´ ë‚˜íƒ€ë‚¬ìŠµë‹ˆë‹¤.

ë„ˆë¬´ ë§ì€ ì‚¬ìš©ìê°€ ipifyì— API ìš”ì²­ì„ ë³´ë‚´ê³  ìˆìŠµë‹ˆë‹¤
ì œ Node ì„œë²„ê°€ ìš”ì²­ì— ëŒ€í•´ ëŠë¦¬ê²Œ ì‘ë‹µí•´ì„œ ì§€ì—°ì´ ëŠ˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤
Herokuì˜ ë¡œë“œë²¨ëŸ°ì„œê°€ ì´ ë¬¸ì œë¥¼ ì•Œì•„ì°¨ë¦¬ê³  Node ì„œë²„ì— ë³´ë‚´ê¸° ì „ì— ìš”ì²­ì„ ë²„í¼ì— ì €ì¥í–ˆë‹¤ê°€ ë³´ë‚´ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤.
Node ì„œë²„ê°€ ë¹ ë¥´ê²Œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ì§€ ëª»í•œ íƒ“ì— ë¡œë“œë²¨ëŸ°ì„œì—ì„œ ì‚¬ìš©ìì—ê²Œ 503ì„ ì „ë‹¬í•˜ê³  ìš”ì²­ì„ ëë‚´ë²„ë ¸ìŠµë‹ˆë‹¤.
ê·¸ë‹¤ì§€ ì¢‹ì€ ëª¨ìŠµì´ ì•„ë‹™ë‹ˆë‹¤.

ì´ ë¬¸ì œë¥¼ í•´ê²°í•˜ê¸° ìœ„í•´ í•œ ì¼ì€ ê°„ë‹¨í–ˆìŠµë‹ˆë‹¤. Herokuì— dynoë¥¼ ë” ì¶”ê°€í–ˆìŠµë‹ˆë‹¤. ì´ ë°©ì‹ìœ¼ë¡œ ìˆ˜ìš©ëŸ‰ì„ ë‘ ë°°ë¡œ ëŠ˜ë ¸ê³  ëª¨ë“  ì„œë¹„ìŠ¤ê°€ ë¶€ë“œëŸ½ê²Œ ë™ì‘í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤. ê·¸ ì´ë©´ì—” ë‘ â€œí”„ë¡œë•ì…˜â€ dynoë¥¼ êµ¬ë™í•œ íƒ“ì— ê±°ì˜ 50ë‹¬ëŸ¬ ê°€ëŸ‰ì„ ì§€ë¶ˆí•´ì•¼ í–ˆìŠµë‹ˆë‹¤. ì²« dyno ì´í›„ì—” ì¼ë°˜ ìš”ê¸ˆì¸ dynoë‹¹ ì›” 25ë‹¬ëŸ¬ë¥¼ ì§€ë¶ˆí•´ì•¼ í–ˆìŠµë‹ˆë‹¤.

ì„œë¹„ìŠ¤ê°€ ì´ ì •ë„ë¡œ ì¸ê¸° ìˆë‹¤ë©´ ì›” 50ë‹¬ëŸ¬ë¥¼ ë‚´ëŠ” ê²ƒë„ ë‚˜ì˜ì§€ ì•Šë‹¤ê³  ìƒê°í•´ì„œ ì§€ë¶ˆí•˜ê¸°ë¡œ ê²°ì •í•˜ê³  ë‹¤ì‹œ ì•ˆì •ì ì¸ ìƒí™©ìœ¼ë¡œ ëŒì•„ì˜¬ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œâ€¦ ê·¸ë ‡ê²Œ ë§ì²˜ëŸ¼ ì‰¬ìš´ ë¬¸ì œê°€ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤.

í•œì£¼ë„ ì±„ ì§€ë‚˜ê¸° ì „ì— Herokuì—ì„œ ì´ì „ê³¼ ë™ì¼í•œ ê²½ê³ ë¥¼ ë°›ì•˜ìŠµë‹ˆë‹¤. ì‚¬ìš©ëŸ‰ì„ ë³´ë‹ˆ íŠ¸ë˜í”½ì€ ë‘ ë°°ë¡œ ëŠ˜ì—ˆê³  ipifyëŠ” ë” ë§ì€ ì‚¬ìš©ëŸ‰ì„ ë³´ì˜€ìŠµë‹ˆë‹¤.

ì €ëŠ” ë˜ ë‹¤ë¥¸ dynoë¥¼ ì¶”ê°€í•˜ê³  ì›” 75ë‹¬ëŸ¬ë¥¼ ì§€ë¶ˆí•˜ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ê·¸ë˜ë„ ì¢€ ë” ì‚´í´ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. ì €ëŠ” ì§ ëŒì´ë¼ì„œ ì›” 50ë‹¬ëŸ¬ ì´ìƒ ì“°ëŠ” ê±´ ê¸°ìœ ì¼ì´ ì•„ë‹ˆì—ˆìŠµë‹ˆë‹¤.

## The Investigation

* When I started investigating what was going on, the first thing I did was check to see how many requests per second (rps) ipify was actually getting. I was pretty surprised by the number: it was low.

If my memory serves me correctly, ipify was only getting around 10 rps at the time. When I saw how small the number was, I figured something bad must be happening in my code. If I canâ€™t service 10 rps across two small web servers, I must be doing something horribly wrong.

The first thing I noticed was that I was running a single Node process. This was an easy fix: I started using the Node cluster module, and bam: I was immediately running one process for each CPU core. This effectively doubled my throughput on my Heroku dynos.

But 20 rps still seemed like a tiny number so I did some more digging. Instead of doing load testing on Heroku, I did some load testing locally on my laptop.

My laptop was far stronger than a small 512M RAM Heroku dyno, so I figured I should see much better throughput.

I did some testing using the ab tool and was surprised to see that even on my laptop I was unable to surpass a threshold of 30 rps from my Node processes (I run Linux on my laptop and ab works effectively there). I then did some basic profiling and found that Node was spending a lot of time performing basic string manipulation operations (to extract the IP address from the X-Forwarded-For header and clean it up). No matter what I experimented with, I was unable to boost throughput up much above that limit.

At this point, the production ipify service was able to serve roughly 20 RPS across two dynos. ipify was in total serving ~52 million requests/mo. Not impressive.

I decided to rewrite the service in Go (which I started using a few months before) for performance purposes to see whether or not I could get more throughput out of an equivalent Go server.

* ìˆ˜ì‚¬ë¥¼ ì‹œì‘í•˜ë©´ì„œ ê°€ì¥ ë¨¼ì € ì‚´í´ë³¸ ê²ƒì€ ì‹¤ì œë¡œ ipifyê°€ ì´ˆ ë‹¹ ì–¼ë§ˆë‚˜ ë§ì€ ìš”ì²­ì„ ì²˜ë¦¬í•˜ëŠ”ê°€(requests per second, rps)ë¥¼ ì‚´í´ë³´ëŠ” ì¼ì´ì—ˆìŠµë‹ˆë‹¤. ìˆ«ìë¥¼ ë³´ê³  ìƒë‹¹íˆ ë†€ëìŠµë‹ˆë‹¤. ë‚®ì•˜ê±°ë“ ìš”.

ì œ ê¸°ì–µì—ëŠ” ipifyëŠ” 10rps ì •ë„ì˜€ìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ì‘ì€ ìˆ«ìë¥¼ ì²˜ë¦¬í•  ìˆ˜ ì—†ë‹¤ë©´ ë­”ê°€ ì½”ë“œê°€ ë¬¸ì œë¼ê³  ìƒê°í–ˆìŠµë‹ˆë‹¤. ë§Œì•½ 10rpsë¥¼ ì‘ì€ ì›¹ ì„œë²„ ë‘ ê°œë¥¼ ì‚¬ìš©í•˜ëŠ”ë°ë„ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ìƒíƒœë¼ë©´ ë”ì°í•˜ê²Œ ì˜ëª»ëœ ê²ƒì´ ë¶„ëª…í–ˆìŠµë‹ˆë‹¤.

ì²˜ìŒ ì•Œì•„ì°¨ë¦° ê²ƒì€ ë‹¨ì¼ Node í”„ë¡œì„¸ìŠ¤ë¡œ ì²˜ë¦¬í•˜ê³  ìˆë‹¤ëŠ” ì ì´ì—ˆìŠµë‹ˆë‹¤. Nodeì˜ í´ëŸ¬ìŠ¤í„° ëª¨ë“ˆì„ ì‚¬ìš©í•´ì„œ ì‰½ê²Œ ê³ ì¹  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ì œ ê°ê°ì˜ CPU ì½”ì–´ì—ì„œ í•˜ë‚˜ì˜ í”„ë¡œì„¸ìŠ¤ë¥¼ êµ¬ë™í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. íš¨ê³¼ì ìœ¼ë¡œ dynoì—ì„œ ë‘ ë°°ì˜ ì²˜ë¦¬ëŸ‰ì„ ë‹¤ë£° ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

í•˜ì§€ë§Œ 20 rpsëŠ” ì—¬ì „íˆ ì‘ì€ ìˆ«ìë¡œ ëŠê»´ì ¸ì„œ ì¢€ ë” ê¹Šì´ íŒŒí—¤ì³ë³´ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. Herokuì—ì„œ ë¡œë“œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í•˜ê¸°ë³´ë‹¤ ì œ ë©íƒ‘ì—ì„œ ë¡œì»¬ë¡œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í–ˆìŠµë‹ˆë‹¤.

ì œ ë©íƒ‘ì€ 512M ë¨ì˜ ì‘ì€ Heroku dynoë³´ë‹¤ í›¨ì”¬ ê°•ë ¥í•˜ê¸° ë•Œë¬¸ì— ë” ì²˜ë¦¬ëŸ‰ì´ ë§ì„ ê²ƒìœ¼ë¡œ ìƒê°í–ˆìŠµë‹ˆë‹¤.

ab ë„êµ¬ë¥¼ ì‚¬ìš©í•´ì„œ í…ŒìŠ¤íŠ¸ë¥¼ ìˆ˜í–‰í–ˆê³  ë†€ë„ ìˆ˜ ë°–ì— ì—†ì—ˆìŠµë‹ˆë‹¤. í›¨ì”¬ ì¢‹ì€ ì‚¬ì–‘ì˜ ì œ ë©íƒ‘ì—ì„œë„ 30 rps ì •ë„ ì²˜ë¦¬í•˜ì§€ ëª»í•˜ëŠ” ê²ƒì…ë‹ˆë‹¤. (ì œ ë©íƒ‘ì€ ë¦¬ëˆ…ìŠ¤ë¡œ êµ¬ë™ë˜ê³  ìˆì—ˆê³  abëŠ” íš¨ìœ¨ì ìœ¼ë¡œ ë™ì‘í•˜ëŠ” í™˜ê²½ì´ì—ˆìŠµë‹ˆë‹¤.) ê·¸ë˜ì„œ ê¸°ì´ˆì ì¸ ë¶„ì„ì„ ì‹œì‘í–ˆê³  Nodeì—ì„œ ë‹¨ìˆœí•œ ë¬¸ìì—´ ì¡°ì‘ ë™ì‘ì„ í•˜ëŠ”ë° ë§ì€ ì‹œê°„ì„ ì‚¬ìš©í•œë‹¤ëŠ” ê²ƒì„ í™•ì¸í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. (X-Forwarded-For í—¤ë”ì—ì„œ IP ì£¼ì†Œë¥¼ ì¶”ì¶œí•˜ê³  ë‹¤ë“¬ëŠ” ì¼ì´ì—ˆìŠµë‹ˆë‹¤) ì—¬ëŸ¬ ê°€ì§€ ì‹¤í—˜ì„ í•´ë´¤ì§€ë§Œ, ì´ í•œê³„ë¥¼ ë›°ì–´ë„˜ì„ ë§Œí¼ ì¢‹ì€ ì„±ëŠ¥ì„ ë‚´ëŠ” ê²ƒì€ ë¶ˆê°€ëŠ¥í–ˆìŠµë‹ˆë‹¤.

ì´ ì‹œì ì—ì„œ ipify ì„œë¹„ìŠ¤ëŠ” ë‘ dynoë¥¼ í†µí•´ì„œë„ ê²¨ìš° 20 RPS ì •ë„ ì²˜ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ipifyëŠ” ì›” ~5200ë§Œ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. ê·¸ë‹¤ì§€ ì¸ìƒì ì´ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.

ì´ ì„œë¹„ìŠ¤ë¥¼ Goë¡œ ë‹¤ì‹œ ì‘ì„±í•˜ê¸°ë¡œ í–ˆìŠµë‹ˆë‹¤. (GoëŠ” ëª‡ ë‹¬ ì „ë¶€í„° ì‚¬ìš©í•˜ê¸° ì‹œì‘í–ˆìŠµë‹ˆë‹¤) ë™ì¼í•œ Go ì„œë²„ë¥¼ ì‘ì„±í–ˆì„ ë•Œ ì„±ëŠ¥ ì¸¡ë©´ì—ì„œ ë” ë‚˜ì€ì§€ í™•ì¸í•´ë³´ê³  ì‹¶ì—ˆìŠµë‹ˆë‹¤.

## ipify v1

* Rewriting ipify in Go was a short (but fun) experiment.

It gave me the opportunity to mess around with many different Go routing stacks: Gorilla/mux, Martini, and httprouter. After benchmarking and playing around with all three routing tools, I ended up using httprouter as it performed significantly better than the other two more popular options.

On my laptop I was able to achieve ~2,500 requests/second from my Go server. A massive improvement. The memory footprint was also much lower and hovered around 5M.

With my new found love for Go, I immediately took action and deployed my new Go-based ipify service on Heroku.

The results were fantastic. I was able to get about ~2k RPS of throughput from a single dyno! This brought my hosting back down to $25/mo and my total throughput to ~5.2 billion requests/mo.

Several days later, while talking to a more experienced Go developer, I ended up rewriting some of my string handling functionality which netted me an extra ~1k RPS of throughput. I At this point I was able to sustain ~7.7 billion requests/mo per dyno (give or take a bit).

I was thrilled to say the least.

* ipifyë¥¼ Goë¡œ ë‹¤ì‹œ ì‘ì„±í•˜ëŠ” ì¼ì€ ì§§ì€ (ê·¸ë¦¬ê³  ì¦ê±°ìš´) ì‹¤í—˜ì´ì—ˆìŠµë‹ˆë‹¤.

ì´ ê³¼ì •ì—ì„œ Gorilla/mux, Martiniì™€ httprouter ê°™ì€ ë‹¤ì–‘í•œ Go ë¼ìš°íŒ… ìŠ¤íƒì„ ì‚¬ìš©í•´ë³¼ ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ ì„¸ ê°€ì§€ ë¼ìš°íŒ… ë„êµ¬ë¥¼ ì‚¬ìš©í•´ë³´ê³  ë¹„êµí•´ë³¸ ê²°ê³¼ httprouterê°€ ë‹¤ë¥¸ ë‘˜ì— ë¹„êµí•´ ë¹„ì•½ì ìœ¼ë¡œ ì„±ëŠ¥ì´ ì¢‹ì€ ê²ƒì„ í™•ì¸í–ˆìŠµë‹ˆë‹¤.

ì œ ë©íƒ‘ì—ì„œ Go ì„œë²„ëŠ” ì´ˆë‹¹ ~2,500 ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì—„ì²­ë‚œ í–¥ìƒì´ì—ˆìŠµë‹ˆë‹¤. ë˜í•œ, ë©”ëª¨ë¦¬ ì‚¬ìš©ëŸ‰ë„ ì—„ì²­ ì ì–´ì„œ 5M ë‚¨ì§“ì„ ì‚¬ìš©í–ˆìŠµë‹ˆë‹¤.

Goì™€ ì‚¬ë‘ì— ë¹ ì§„ ì €ëŠ” ì¦‰ì‹œ í–‰ë™ìœ¼ë¡œ ì˜®ê²¼ìŠµë‹ˆë‹¤. Go ê¸°ë°˜ ipify ì„œë¹„ìŠ¤ë¥¼ Herokuì— ë°°í¬í–ˆìŠµë‹ˆë‹¤.

ê²°ê³¼ëŠ” í™˜ìƒì ì´ì—ˆìŠµë‹ˆë‹¤. ë‹¨ì¼ dynoì—ì„œ 2ì²œ RPS ì •ë„ë¥¼ ì²˜ë¦¬í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ëŸ° ë³€í™”ëŠ” ì›” 25ë‹¬ëŸ¬ ìˆ˜ì¤€ìœ¼ë¡œ ì›” ~52ì–µ ìš”ì²­ì„ ì²˜ë¦¬í•  ìˆ˜ ìˆê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤.

ëª‡ì¼ í›„ì— ê²½í—˜ ìˆëŠ” Go ê°œë°œìì™€ ëŒ€í™”ë¥¼ í•œ í›„, ë¬¸ìì—´ì„ ì²˜ë¦¬í•˜ëŠ” ê¸°ëŠ¥ ëª‡ ê°€ì§€ë¥¼ ë‹¤ì‹œ ì‘ì„±í–ˆê³  ê·¸ ë•ë¶„ì— ì¶”ê°€ë¡œ ~1ì²œ RPS ì •ë„ë¥¼ í™•ë³´í•  ìˆ˜ ìˆì—ˆìŠµë‹ˆë‹¤. ì´ ì‹œì ì— dyno ë‹¹ ì›” ~77ì–µ ìš”ì²­ì„ ì²˜ë¦¬í•˜ê³  ìˆì—ˆìŠµë‹ˆë‹¤. (ì¡°ê¸ˆ ë” ë§ê±°ë‚˜ ì ì—ˆìŠµë‹ˆë‹¤.)

ì €ëŠ” ë§í•  ê²ƒë„ ì—†ì´ í¥ë¶„í–ˆìŠµë‹ˆë‹¤.

## More Popularity

* Although I was able to cut back my hosting cost down to a reasonable range for a short period of time, within roughly two months ipify started experiencing issues once more.

Itâ€™s growth had continued to rise at an astounding rate. Around this time I had set up Google Alerts for ipify, so that Iâ€™d know when people mentioned it.

I started getting notifications that more and more people started using ipify in their personal and work projects. I then began receiving email from companies asking if they can embed it in their products (including a large smart TV provider, numerous media agencies, IoT vendors, etc.).

Before I knew it ipify was servicing around 15 billion requests/mo and I was now back to spending $50/mo on hosting costs.

But that too didnâ€™t last for long.

I noticed rather quickly that ipifyâ€™s traffic continued to rapidly increase. There was a period of several months where it would add an additional billion requests each month.

I also started having issues with burst traffic â€“ ipify would receive massive amounts of burst traffic for a short period of time that would die off quickly. I presumed this traffic was part of bootstrapping scripts, cron jobs, and other similar timed operations.

I later discovered through user notifications that antivirus vendors started blocking ipify because it started getting used in root kits, viruses, and other nasty pieces of software. Attackers would use ipify to get the victimâ€™s public IP address before firing it off to a central location to be used for malicious purposes. I suppose this sort of usage was responsible for a large amount of that burst traffic.

While Iâ€™m not a fan of helping VX authors or spending money to assist them, I made the decision to keep ipify running neutrally to serve anyone who wants to use it. Iâ€™ve never been a fan of developer services that pick and choose what people use them for. I like to keep things simple.

Which left me to deal with the burst traffic problem. Dealing with burst traffic was tricky because I primarily had two choices:

Run additional dynos at a cost to myself and be always prepared for burst traffic, or
Use an auto scaling tool like Adept to automatically create and destroy dynos based on traffic patterns on my behalf
I eventually decided to manually involve myself and go with option #1, simply because I didnâ€™t want to spend any additional funds on Adeptâ€™s service (even though Iâ€™ve used it before, and it is fantastic). Around this time I was spending $150/mo and ipify was servicing ~25 billion requests/mo.

Which brings us to the recent past.

* ì§€ë‚œ ëª‡ ë‹¬ ë™ì•ˆ ipifyëŠ” ìƒˆë¡œìš´ ê¸°ë¡ì„ ëƒˆê³  ì›”ê°„ 300ì–µ ìš”ì²­ì„ ëª‡ ì°¨ë¡€ ë„˜ì—ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ìƒˆë¡œìš´ ê¸°ë¡ì„ ê²½ì‹ í•˜ëŠ” ì¼ì€ ì§€ì¼œë³´ëŠ” ì¦ê±°ì›€ì´ ìˆìŠµë‹ˆë‹¤.

ì˜¤ëŠ˜ë‚  ipifyëŠ” 2ì²œì—ì„œ 2ë§Œ RPSë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. (ì´ ìˆ˜ì¹˜ëŠ” í•­ìƒ ì ˆëŒ€ ì¼ê´€ì ì´ì§ˆ ì•Šì•˜ìŠµë‹ˆë‹¤.) íŠ¸ë˜í”½ì€ í•­ìƒ ë‹¬ë¼ì¡Œê³  ì‚¬ìš©ëŸ‰ì€ ì •ê¸°ì ìœ¼ë¡œ ë†’ì•„ì¡ŒëŠ”ë° íŠ¸ë˜í”½ íŒ¨í„´ì—ì„œ ì˜ë¯¸ë¥¼ ì°¾ëŠ” ê±¸ ì™„ì „íˆ í¬ê¸°í–ˆìŠµë‹ˆë‹¤. í‰ê·  ì‘ë‹µ ì‹œê°„ì€ íŠ¸ë˜í”½ íŒ¨í„´ì— ë”°ë¼ 1~20ms ì‚¬ì´ë¥¼ ìœ ì§€í–ˆìŠµë‹ˆë‹¤.

í˜„ì¬ ì„œë¹„ìŠ¤ëŠ” íŠ¸ë˜í”½ê³¼ ì—¬ëŸ¬ ìš”ì¸ì— ë”°ë¼ ì›”ê°„ 150~200ë‹¬ëŸ¬ë¡œ ìš´ì˜ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì›”ê°„ 200ë‹¬ëŸ¬ë¥¼ ì†Œë¹„í•œë‹¤ê³  ê°€ì •í•˜ê³  ìˆ˜ì¹˜ë¥¼ ê³„ì‚°í•´ë³´ë©´ ipifyëŠ” ê° ìš”ì²­ì„ 0.000000007ë‹¬ëŸ¬ë¡œ ìš´ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì¶©ê²©ì ìœ¼ë¡œ ë‚®ì€ ë¹„ìš©ì´ì£ .

ë§Œì•½ ì´ ì„œë¹„ìŠ¤ë¥¼ Lambdaì—ì„œ ëŒë¦°ë‹¤ê³  ê°€ì •í•˜ê³  ìš”ê¸ˆì„ ê³„ì‚°í•´ë³¸ë‹¤ë©´ ì›”ê°„ 1,243.582ë‹¬ëŸ¬ (ì—°ì‚°) + 6,000ë‹¬ëŸ¬ (ìš”ì²­) = ~ 7,243.58ë‹¬ëŸ¬ ì •ë„ë¥¼ ì‚¬ìš©í•˜ê²Œ ë  ê²ë‹ˆë‹¤. ì°¸ê³ ë¡œ ì´ê±´ ê°„ë‹¨í•œ ì…ê³„ì‚°ì…ë‹ˆë‹¤. ipifyì˜ ìˆ˜ì¹˜ë¥¼ Lambda ìš”ê¸ˆ ê³„ì‚°ê¸°ì— ì…ë ¥í•´ì„œ ì–»ì€ ê²°ê³¼ì…ë‹ˆë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ ipifyì— ë“¤ì–´ê°€ëŠ” ë¹„ìš©ì— ì—„ì²­ë‚˜ê²Œ ë§Œì¡±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ ìš©ë„ë¥¼ ì œê³µí•˜ëŠ” ì§ ëŒì´ ì„œë¹„ìŠ¤ì£ .

## ipify Hits 30 Billion Requests

* Over the past few months, ipify has hit a new record and surpassed 30 billion requests/mo on several occasions. It was an exciting milestone to surpass and something that has been fun to watch.

Today, ipify routinely serves between 2k and 20k RPS (which is almost never consistent). Traffic is always variable and the usage is so routinely high that Iâ€™ve completely given up on trying to detect traffic patterns in any meaningful way. Average response time ranges between 1 and 20ms depending on traffic patterns.

Today the service runs for between $150/mo and $200/mo depending on burst traffic and other factors. If I factor that into my calculator (assuming a $200/mo spend), it looks as if ipify is able to service each request for total cost of $0.000000007. Thatâ€™s astoundingly low.

If you compare that to the expected cost of running the same service on something like Lambda, ipify would rack up a total bill of: $1,243.582/mo (compute) + $6,000/mo (requests) = ~$7,243.58. As a quick note, this is some back-of-a-napkin math. I plugged ipifyâ€™s numbers into a Lambda pricing example from the AWS website here: https://aws.amazon.com/lambda/pricing/.

All in all, Iâ€™m extremely satisfied with ipifyâ€™s cost. Itâ€™s a frugal service that serves a simple purpose.

* ì§€ë‚œ ëª‡ ë‹¬ ë™ì•ˆ ipifyëŠ” ìƒˆë¡œìš´ ê¸°ë¡ì„ ëƒˆê³  ì›”ê°„ 300ì–µ ìš”ì²­ì„ ëª‡ ì°¨ë¡€ ë„˜ì—ˆìŠµë‹ˆë‹¤. ì´ë ‡ê²Œ ìƒˆë¡œìš´ ê¸°ë¡ì„ ê²½ì‹ í•˜ëŠ” ì¼ì€ ì§€ì¼œë³´ëŠ” ì¦ê±°ì›€ì´ ìˆìŠµë‹ˆë‹¤.

ì˜¤ëŠ˜ë‚  ipifyëŠ” 2ì²œì—ì„œ 2ë§Œ RPSë¥¼ ìœ ì§€í•˜ê³  ìˆìŠµë‹ˆë‹¤. (ì´ ìˆ˜ì¹˜ëŠ” í•­ìƒ ì ˆëŒ€ ì¼ê´€ì ì´ì§ˆ ì•Šì•˜ìŠµë‹ˆë‹¤.) íŠ¸ë˜í”½ì€ í•­ìƒ ë‹¬ë¼ì¡Œê³  ì‚¬ìš©ëŸ‰ì€ ì •ê¸°ì ìœ¼ë¡œ ë†’ì•„ì¡ŒëŠ”ë° íŠ¸ë˜í”½ íŒ¨í„´ì—ì„œ ì˜ë¯¸ë¥¼ ì°¾ëŠ” ê±¸ ì™„ì „íˆ í¬ê¸°í–ˆìŠµë‹ˆë‹¤. í‰ê·  ì‘ë‹µ ì‹œê°„ì€ íŠ¸ë˜í”½ íŒ¨í„´ì— ë”°ë¼ 1~20ms ì‚¬ì´ë¥¼ ìœ ì§€í–ˆìŠµë‹ˆë‹¤.

í˜„ì¬ ì„œë¹„ìŠ¤ëŠ” íŠ¸ë˜í”½ê³¼ ì—¬ëŸ¬ ìš”ì¸ì— ë”°ë¼ ì›”ê°„ 150~200ë‹¬ëŸ¬ë¡œ ìš´ì˜ë˜ê³  ìˆìŠµë‹ˆë‹¤. ì›”ê°„ 200ë‹¬ëŸ¬ë¥¼ ì†Œë¹„í•œë‹¤ê³  ê°€ì •í•˜ê³  ìˆ˜ì¹˜ë¥¼ ê³„ì‚°í•´ë³´ë©´ ipifyëŠ” ê° ìš”ì²­ì„ 0.000000007ë‹¬ëŸ¬ë¡œ ìš´ì˜í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì¶©ê²©ì ìœ¼ë¡œ ë‚®ì€ ë¹„ìš©ì´ì£ .

ë§Œì•½ ì´ ì„œë¹„ìŠ¤ë¥¼ Lambdaì—ì„œ ëŒë¦°ë‹¤ê³  ê°€ì •í•˜ê³  ìš”ê¸ˆì„ ê³„ì‚°í•´ë³¸ë‹¤ë©´ ì›”ê°„ 1,243.582ë‹¬ëŸ¬ (ì—°ì‚°) + 6,000ë‹¬ëŸ¬ (ìš”ì²­) = ~ 7,243.58ë‹¬ëŸ¬ ì •ë„ë¥¼ ì‚¬ìš©í•˜ê²Œ ë  ê²ë‹ˆë‹¤. ì°¸ê³ ë¡œ ì´ê±´ ê°„ë‹¨í•œ ì…ê³„ì‚°ì…ë‹ˆë‹¤. ipifyì˜ ìˆ˜ì¹˜ë¥¼ Lambda ìš”ê¸ˆ ê³„ì‚°ê¸°ì— ì…ë ¥í•´ì„œ ì–»ì€ ê²°ê³¼ì…ë‹ˆë‹¤.

ê²°ë¡ ì ìœ¼ë¡œ ipifyì— ë“¤ì–´ê°€ëŠ” ë¹„ìš©ì— ì—„ì²­ë‚˜ê²Œ ë§Œì¡±í•˜ê³  ìˆìŠµë‹ˆë‹¤. ê°„ë‹¨í•œ ìš©ë„ë¥¼ ì œê³µí•˜ëŠ” ì§ ëŒì´ ì„œë¹„ìŠ¤ì£ .

## ipifyâ€™s Future

ì´ì œ ë¯¸ë˜ë¥¼ ìƒê°í•´ë³´ê²Œ ë˜ì—ˆìŠµë‹ˆë‹¤. ipifyëŠ” ì§€ì†í•´ì„œ ì„±ì¥í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì„œë¹„ìŠ¤ëŠ” ipv6 ì§€ì› (Herokuê°€ í˜„ì¬ ì§€ì›í•˜ì§€ ì•Šì•„ìš” ğŸ™), ë” ë‚˜ì€ ì›¹ë””ìì¸, IP ì£¼ì†Œì— ëŒ€í•œ ë‹¤ë¥¸ ë©”íƒ€ë°ì´í„° ë“± ì—¬ëŸ¬ ê°€ì§€ ìš”ì²­ì„ ë°›ê³  ìˆìŠµë‹ˆë‹¤.
* Which leads me to the future. As ipify continues to grow, the service has gotten requests for a lot of different things: ipv6 support (something that Heroku does not support :(), better web design, other metadata about IP addresses, etc.

ìµœê·¼ ë‹¤ë¥¸ í”„ë¡œì íŠ¸ ë•ë¶„ì— ì—„ì²­ë‚˜ê²Œ ë°”ìœ íƒ“ì— ipifyì˜ ì†Œìœ ê¶Œì„ ì œ ì¢‹ì€ ì¹œêµ¬ì¸ https://www.whoisxmlapi.comì— ë„˜ê²¼ìŠµë‹ˆë‹¤.
* As Iâ€™m incredibly busy with other projects nowadays, I ended up passing ownership of ipify along to my good friends at https://www.whoisxmlapi.com.

ì¡°ë‚˜ë‹¨ê³¼ ê·¸ì˜ íŒ€ì€ ê°€ì¹˜ ìˆê³  í¥ë¯¸ë¡œìš´ ê°œë°œì API ì„œë¹„ìŠ¤ë¥¼ ë§Œë“œëŠ”ë° ì œê²©ì¸ í¬íŠ¸í´ë¦¬ì˜¤ë¥¼ ê°–ê³  ìˆìŠµë‹ˆë‹¤.
* Jonathan and team are good people working to build a portfolio of valuable and interesting developer API services.

ì œê°€ ì§€ì†í•´ì„œ ë•ê³  ìˆê¸´ í•˜ì§€ë§Œ ì¡°ë‚˜ë‹¨ê³¼ ê·¸ì˜ íŒ€ì€ í˜„ì¬ ipifyì˜ ìƒˆë¡œìš´ ê¸°ëŠ¥ì„ êµ¬í˜„í•˜ê³  ìˆìŠµë‹ˆë‹¤. ì œê°€ ê¸°ëŒ€í•˜ëŠ” ì¢‹ì€ ë³€í™”ë¥¼ ë°˜ì˜í•˜ê¸° ìœ„í•´ ì—´ì‹¬íˆ ì‘ì—…í•˜ê³  ìˆìŠµë‹ˆë‹¤. (ë” ë‚˜ì€ UIì™€ ë°ì´í„° ì—”ë“œí¬ì¸íŠ¸ë¥¼ í¬í•¨í•´ì„œ ë§ì…ë‹ˆë‹¤.)
* While I still help out with things from time-to-time, Jonathan and team are currently implementing new features for ipify, and working hard to roll out some pretty cool changes that Iâ€™m excited about (including an improved UI and more data endpoint).

ì €ëŠ” ì•ìœ¼ë¡œë„ ê¾¸ì¤€íˆ ì„±ì¥í•  ipifyê°€ ê¸°ëŒ€ë©ë‹ˆë‹¤.
* I look forward to seeing how ipify continues to grow over the coming years.

> Randall Degges (r@rdegges.com)
 + I'm just a happy programmer that likes to hack stuff.


